---
import BaseLayout from "@layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Génère toutes les routes statiques à partir des fichiers .md de src/content/projets
export async function getStaticPaths() {
  const projets = await getCollection("projets");

  return projets.map((projet) => ({
    params: { slug: projet.slug },
    props: { projet },
  }));
}

const { projet } = Astro.props;
const { Content } = await projet.render();

const title = `${projet.data.title} — Projets — Sabbahi Sonia`;
const description = projet.data.description ?? "Détail du projet.";
---

<BaseLayout {title} {description}>
  <section class="py-16 md:py-24 max-w-3xl mx-auto px-4 space-y-10">

    <!-- RETOUR -->
    <div>
      <a
        href="/projets"
        class="text-sm opacity-70 hover:opacity-100 link-soft-underline inline-flex items-center gap-1"
      >
        ← Retour aux projets
      </a>
    </div>

    <!-- EN-TÊTE DU PROJET -->
    <header class="space-y-3">
      <p class="text-xs uppercase tracking-[0.2em] opacity-60">
        Projet
      </p>
      <h1 class="text-3xl font-bold">
        {projet.data.title}
      </h1>

      {projet.data.description && (
        <p class="text-base opacity-80 max-w-2xl">
          {projet.data.description}
        </p>
      )}

      <div class="flex flex-wrap items-center gap-3 text-xs opacity-70 pt-2">
        {projet.data.date && (
          <span>
            {new Date(projet.data.date).toLocaleDateString("fr-FR", {
              year: "numeric",
              month: "long",
            })}
          </span>
        )}

        {projet.data.client && (
          <>
            <span>•</span>
            <span>Client : {projet.data.client}</span>
          </>
        )}

        {projet.data.context && (
          <>
            <span>•</span>
            <span>{projet.data.context}</span>
          </>
        )}
      </div>

      {projet.data.tech && Array.isArray(projet.data.tech) && (
        <div class="flex flex-wrap gap-2 pt-3">
          {projet.data.tech.map((t) => (
            <span class="inline-flex items-center rounded-full border border-neutral-300/60 dark:border-neutral-700/60 px-2.5 py-0.5 text-[11px] uppercase tracking-wide opacity-80">
              {t}
            </span>
          ))}
        </div>
      )}

      {projet.data.link && (
        <div class="pt-4">
          <a
            href={projet.data.link}
            target="_blank"
            rel="noreferrer"
            class="btn-main text-xs sm:text-sm"
          >
            Voir le projet en ligne
          </a>
        </div>
      )}
    </header>

    <!-- CONTENU MARKDOWN -->
    <article class="prose prose-neutral dark:prose-invert prose-sm sm:prose-base max-w-none">
      <Content />
    </article>

  </section>
</BaseLayout>




